---
layout: post
title: 'MEVN교과서 (5)'
author: kundol
comments: true
date: 2019-06-30 12:00
tags: [MEVN교과서]
sitemap: yes
excerpt: MEVN교과서 (5)

---    

![MEVN교과서](https://raw.githubusercontent.com/wnghdcjfe/wnghdcjfe.github.io/master/MEVN/mevnlogo_4장.jpg)
## 4. 실시간 데이터시각화사이트제작  
이제 드디어 실시간 데이터시각화사이트를 제작할 것입니다. 데이터를 시각화를 하기 위해서는 시각화 라이브러리가 필요합니다. D3.js, chart.js 등 많은 라이브러리를 비교하교 장점과 단점을 비교할 것입니다. 그 후 D3.js로 간단하게 사용법을 알아보고 지도, 증가하는 숫자모듈을 만들고 RESTAPI사용법에 대해서 알아보겠습니다. 

실시간통신을 위해서는 websocket사용은 필수입니다. 하지만 오래된 브라우저를 위한 polling이라는 기법또한 알아볼 것입니다. 그 후 디자인을 어떻게 짤 것인지 알아보고 마지막으로 차트컴포넌트와 전에 만든 증가하는 숫자 모듈로 하드웨어 모니터링 시스템까지 완벽하게 알아보겠습니다.

### 4.1 시각화 라이브러리 D3.js
어떠한 데이터를 시각화하는 것은 중요한 일입니다. 같은 데이타라도 다르게 보여줄 수 있으며 효과적으로 내가 주장하는 바를 강하게 나타낼 수 있습니다. 

![콜레라지도](https://w.namu.la/s/6c3158c18fe2d603f52f9ea42944939679abd221f8e2ca97363175550b93ed4ac7f72f404523f13215118118cd6be01873b897a767d89693fadf2597ffe54aba1c54f4f2adc949746580eb079ff7e99b9f29ab4ab94faff1e833031556a2c559)
실제로 데이타 시각화는 사람을 살리는 일도 합니다. 

빅토리아 여왕 시대의 의사인 존스노우는 콜레라가 수인성 전염병이라는 것을 파악하기 위해 펌프가 있는 지역들을 위처럼 시각화 했고 이를 통해 콜레라가 펌프와 상관관계여부를 파악하고 규칙성을 찾아내었습니다.  

이러한 시각화를 도와주는 좋은 도구인 시각화라이브러리중 하나인 D3.js를 소개합니다.
D3를 사용하면 임의의 데이터를 DOM (Document Object Model)에 바인딩 한 다음 문서에 데이터 기반 변환을 적용 할 수 있습니다. 예를 들어 D3을 사용하여 숫자로 이루어진 배열에서 HTML 테이블을 생성 할 수있고 바차트, 선차트 등을 만들 수 있습니다.  이외에도 지도, flow, treemap, pie chart, 상호작용, 애니메이션 등 무궁무진하게 정말 많은 시각화그림들을 만들 수 있습니다.
매우 작은 용량의 라이브러리로 정말 작은 부분 하나하나 세세하게 커스터마이징이 가능한 장점을 가지고 있습니다. 

#### 4.1.1 D3의 구조 및 다른 시각화라이브러리
무언가 프로젝트를 하기 위해 Stack을 설정할 때 다른 라이브러리와의 비교는 필수입니다. 그렇다면 현존하는 라이브러리와 D3.js를 비교해보겠습니다. 

2019년 7월 28일 기준입니다. 각 라이브러리의 최신버전을 통해 비교했습니다.

| 라이브러리 | 용량(min기준) | 러닝커브 | 활용도 |
|:--------|:--------| 
| chart.js	| 153kb | 쉬움 | 보통 |
| echarts.js | 729kb | 매우쉬움 | 보통 |
| three.js	| 562kb | 보통 | 높음 | 
| D3.js	| 237kb | 보통 | 매우높음 |

#### chart.js 버전 : 2.8.0
chart.js는 영역차트, 바차트, pie차트 등 차트에 국한 되어있습니다. 단순히 차트만 구현한다면 chart.js는 좋은 선택입니다. 

라인차트를 구현하는데 이정도의 script만 있으면 됩니다.
```js
var ctx = document.getElementById('myChart').getContext('2d');
var chart = new Chart(ctx, { 
    type: 'line', 
    data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'category', 
            data: [820, 932, 901, 934, 1290, 1330, 1320]
        }]
    }, 
    options: {}
}); 
```
#### echarts.js 버전 : 4.2.1
echarts.js는 사용하기가 매우 쉽습니다. 
라인차트를 구현하는데 이정도의 script만 있으면 됩니다. 또한, geomap, Radar Chart, Heatmap, Graph, Treemap, flow 등 여러가지를 구현할 수 있습니다. 필자도 토이 프로젝트를 할 때 빠르게 차트를 구현하기 위해 echarts를 구현할 정도로 정말 쉽고 빠르게 만들 수 있습니다. 써보면 아시겠지만 chart.js보다 쉽습니다. 하지만 용량이 상당이 거대하기 때문에 큰 프로젝트에서는 추천하지 않습니다.
```js
option = {
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line'
    }]
};  
var myChart = echarts.init(document.getElementById("container"));
myChart.setOption(option, true);  
```

#### three.js 버전 : 0.106.2
three.js는 가장 유명한 자바스크립트 3D 라이브러리 중 하나입니다. 무겁기도 하고 하드웨어의 성능을 많이 잡아 먹기 때문에 모바일에서 이를 활용한 앱을 켰을 때 버벅거리는 증상이 나타나기도 합니다. 정말 많은 3D 차트 등을 구현할 수 있습니다. 

#### D3.js 버전 : 5.9.7
D3.js는 3D는 아니지만 2D로 구현이 가능한 모든 시각화적인 것들을 구현할 수 있습니다. 차트, 맵은 기본이며 중력도 구현이 가능하며 워드클라우드, 플로우, 못하는 것이 없습니다. 하지만 D3.js를 이용하기 위해서는 데이타가 어떻게 그려지는지 원리부터 차근차근 알아가야 쓸 수 있습니다. chart.js나 echart.js처럼 간단히 데이타만 넣고 알아서 차트가 그려지지는 않습니다. 

그러나 이러한 번거로움을 뒤로한채 최고라고 말할 수 있는 이유는 237kb라는 작은 용량으로 정말 다양한 시각화적인 요소를 표현할 수 있다는 점과 매우 작은 부분 까지 커스터마이징하기가 쉽다는 것입니다. 물론 chart.js나 echart.js로도 가능하지만 설계될 때 그렇게 커스터마이징을 설계하지 않았는지 커스터마이징을 하려면 chart.js 내부안에 들어가서 바꿔야 하거나 echart.js로 들어가 바꿔야합니다.

#### 4.1.2 간단한 예제 circle, rectangle, data, enter, selectAll  

### 4.2 D3.js : 지도매핑모듈
#### 4.2.1 topojson과 geojson비교
#### 4.2.2 메르카토르 도법과 geolib 라이브러리
#### 4.2.3 지도 매핑모듈과 zoom이벤트

### 4.3 D3.js : 증가하는 숫자
#### 4.3.1 d3.pie소개
#### 4.3.2 d3 interporate 
#### 4.3.3 증가하는 숫자 만들기  
  
### 4.4  실시간 센서시각화사이트 : REST API 구축
#### 4.4.1 REST API 특징
#### 4.4.2 CORS 및 주의사항
#### 4.4.3 요청 제한 및 IP 설정   
#### 4.4.4 센서생성 서버 REST API 구축
 
### 4.5  실시간 센서시각화사이트 : 실시간통신과 디자인
#### 4.5.1 websocket방식과 polling 방식 비교
#### 4.5.2 socket.io를 이용한 간단한 채팅 예제
#### 4.5.3 Vuex 및 프로젝트 뼈대 구축
#### 4.5.4 디자인 가이드 구축

### 4.6  실시간 센서시각화사이트 : 차트 컴포넌트 
#### 4.6.1 차트 컴포넌트제작
#### 4.6.2 고정된 데이타를 기준으로 차트 
#### 4.6.3 업데이트되는 데이타를 기준으로 차트
#### 4.6.4 tooltip 이벤트
#### 4.6.5 REST API와 연동되어 실제 데이터와 차트구축
#### 4.6.6 메모이제이션 알고리즘을 적용하여 서버요청 최적화 

### 4.7  실시간 센서시각화사이트 : 모니터링 모듈 
#### 4.7.1 CPU, 하드웨어 모니터링 모듈 제작